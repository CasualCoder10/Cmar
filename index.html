<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeMarket - Buy and Sell Code</title>
    <style>
        :root {
            --primary: #3498db;
            --primary-dark: #2980b9;
            --secondary: #2ecc71;
            --dark: #34495e;
            --light: #ecf0f1;
            --danger: #e74c3c;
            --warning: #f39c12;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f8fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        header {
            background-color: var(--dark);
            color: white;
            padding: 1rem 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            display: flex;
            align-items: center;
        }
        
        .logo span {
            color: var(--primary);
        }
        
        .nav-links {
            display: flex;
            list-style: none;
        }
        
        .nav-links li {
            margin-left: 1.5rem;
        }
        
        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }
        
        .nav-links a:hover {
            color: var(--primary);
        }
        
        .hero {
            background: linear-gradient(to right, var(--dark), var(--primary-dark));
            color: white;
            padding: 4rem 0;
            text-align: center;
        }
        
        .hero h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }
        
        .hero p {
            font-size: 1.2rem;
            max-width: 700px;
            margin: 0 auto 2rem;
        }
        
        .btn {
            display: inline-block;
            background-color: var(--secondary);
            color: white;
            padding: 0.7rem 1.5rem;
            border: none;
            border-radius: 4px;
            font-size: 1rem;
            cursor: pointer;
            text-decoration: none;
            transition: background-color 0.3s;
        }
        
        .btn:hover {
            background-color: #27ae60;
        }
        
        .btn-primary {
            background-color: var(--primary);
        }
        
        .btn-primary:hover {
            background-color: var(--primary-dark);
        }
        
        .btn-outline {
            background-color: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }
        
        .btn-outline:hover {
            background-color: var(--primary);
            color: white;
        }
        
        .features {
            padding: 4rem 0;
        }
        
        .section-header {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .section-header h2 {
            font-size: 2rem;
            color: var(--dark);
            margin-bottom: 1rem;
        }
        
        .section-header p {
            color: #777;
            max-width: 700px;
            margin: 0 auto;
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }
        
        .feature-card {
            background-color: white;
            border-radius: 8px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
        }
        
        .feature-icon {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }
        
        .feature-card h3 {
            margin-bottom: 1rem;
            color: var(--dark);
        }
        
        .marketplace {
            padding: 4rem 0;
            background-color: var(--light);
        }
        
        .marketplace-controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .search-bar {
            flex-grow: 1;
            position: relative;
            max-width: 500px;
        }
        
        .search-bar input {
            width: 100%;
            padding: 0.7rem 1rem;
            border: 2px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        
        .filters {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        
        .filter-select {
            padding: 0.7rem;
            border: 2px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            background-color: white;
        }
        
        .listings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
        }
        
        .listing-card {
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        
        .listing-card:hover {
            transform: translateY(-5px);
        }
        
        .listing-image {
            height: 160px;
            background-color: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
        }
        
        .listing-content {
            padding: 1.5rem;
        }
        
        .listing-tag {
            display: inline-block;
            background-color: #e0f7fa;
            color: var(--primary-dark);
            padding: 0.2rem 0.5rem;
            border-radius: 3px;
            font-size: 0.8rem;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
        }
        
        .listing-title {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            color: var(--dark);
        }
        
        .listing-price {
            font-size: 1.25rem;
            font-weight: bold;
            color: var(--secondary);
            margin-bottom: 1rem;
        }
        
        .listing-meta {
            display: flex;
            justify-content: space-between;
            color: #777;
            font-size: 0.9rem;
        }
        
        .how-it-works {
            padding: 4rem 0;
        }
        
        .steps {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-top: 3rem;
        }
        
        .step {
            text-align: center;
            padding: 1.5rem;
        }
        
        .step-number {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 50px;
            height: 50px;
            background-color: var(--primary);
            color: white;
            border-radius: 50%;
            font-size: 1.5rem;
            font-weight: bold;
            margin: 0 auto 1.5rem;
        }
        
        .testimonials {
            padding: 4rem 0;
            background-color: var(--light);
        }
        
        .testimonial-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }
        
        .testimonial-card {
            background-color: white;
            border-radius: 8px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .testimonial-content {
            font-style: italic;
            margin-bottom: 1.5rem;
            color: #555;
        }
        
        .testimonial-author {
            display: flex;
            align-items: center;
        }
        
        .author-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #ddd;
            margin-right: 1rem;
            overflow: hidden;
        }
        
        .author-info h4 {
            color: var(--dark);
            margin-bottom: 0.25rem;
        }
        
        .author-info p {
            color: #777;
            font-size: 0.9rem;
        }
        
        .cta {
            padding: 4rem 0;
            background: linear-gradient(to right, var(--primary-dark), var(--primary));
            color: white;
            text-align: center;
        }
        
        .cta h2 {
            font-size: 2rem;
            margin-bottom: 1.5rem;
        }
        
        .cta p {
            max-width: 700px;
            margin: 0 auto 2rem;
            font-size: 1.1rem;
        }
        
        footer {
            background-color: var(--dark);
            color: white;
            padding: 3rem 0 1rem;
        }
        
        .footer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        .footer-column h3 {
            font-size: 1.2rem;
            margin-bottom: 1.5rem;
        }
        
        .footer-links {
            list-style: none;
        }
        
        .footer-links li {
            margin-bottom: 0.7rem;
        }
        
        .footer-links a {
            color: #bbb;
            text-decoration: none;
            transition: color 0.3s;
        }
        
        .footer-links a:hover {
            color: var(--primary);
        }
        
        .footer-bottom {
            text-align: center;
            padding-top: 2rem;
            border-top: 1px solid #4a5568;
            color: #bbb;
            font-size: 0.9rem;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 8px;
            max-width: 500px;
            width: 100%;
            padding: 2rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            position: relative;
        }
        
        .close-modal {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.5rem;
            cursor: pointer;
            color: #777;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 0.7rem;
            border: 2px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        
        .form-control:focus {
            border-color: var(--primary);
            outline: none;
        }
        
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2rem;
            }
            
            .nav-links {
                display: none;
            }
            
            .mobile-menu-btn {
                display: block;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <nav>
                <div class="logo">
                    Code<span>Market</span>
                </div>
                <ul class="nav-links">
                    <li><a href="#marketplace">Browse</a></li>
                    <li><a href="#" id="sell-code-btn">Sell Code</a></li>
                    <li><a href="#how-it-works">How It Works</a></li>
                    <li><a href="#" id="login-btn">Login</a></li>
                    <li><a href="#" id="signup-btn" class="btn btn-primary">Sign Up</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <section class="hero">
        <div class="container">
            <h1>Buy and Sell High-Quality Code</h1>
            <p>CodeMarket is the premier marketplace for developers to buy and sell code snippets, plugins, full applications, and more. Save time, earn money, and build better software.</p>
            <a href="#marketplace" class="btn btn-primary">Browse Marketplace</a>
            <a href="#" id="hero-sell-btn" class="btn btn-outline">Start Selling</a>
        </div>
    </section>

    <section class="features">
        <div class="container">
            <div class="section-header">
                <h2>Why Choose CodeMarket?</h2>
                <p>We've built the most secure and user-friendly platform for code exchange</p>
            </div>
            <div class="feature-grid">
                <div class="feature-card">
                    <div class="feature-icon">💰</div>
                    <h3>Secure Payments</h3>
                    <p>Our integrated payment system ensures transactions are secure and funds are released only after buyer satisfaction.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">🔄</div>
                    <h3>Simple Process</h3>
                    <p>Easy listing, straightforward purchasing, and hassle-free selling with our intuitive interface.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">✅</div>
                    <h3>Quality Assurance</h3>
                    <p>All code is reviewed for security and quality before being listed on our marketplace.</p>
                </div>
            </div>
        </div>
    </section>

    <section class="marketplace" id="marketplace">
        <div class="container">
            <div class="section-header">
                <h2>Code Marketplace</h2>
                <p>Browse through thousands of high-quality code listings</p>
            </div>
            <div class="marketplace-controls">
                <div class="search-bar">
                    <input type="text" placeholder="Search for code...">
                </div>
                <div class="filters">
                    <select class="filter-select">
                        <option value="">Category</option>
                        <option value="web">Web Development</option>
                        <option value="mobile">Mobile Apps</option>
                        <option value="plugins">Plugins & Extensions</option>
                        <option value="games">Game Development</option>
                        <option value="ai">AI & Machine Learning</option>
                    </select>
                    <select class="filter-select">
                        <option value="">Sort By</option>
                        <option value="newest">Newest</option>
                        <option value="popular">Most Popular</option>
                        <option value="price-low">Price: Low to High</option>
                        <option value="price-high">Price: High to Low</option>
                    </select>
                </div>
            </div>
            <div class="listings-grid">
                <div class="listing-card">
                    <div class="listing-image">Code Preview</div>
                    <div class="listing-content">
                        <span class="listing-tag">React</span>
                        <span class="listing-tag">Frontend</span>
                        <h3 class="listing-title">E-commerce Shopping Cart Component</h3>
                        <div class="listing-price">$49.99</div>
                        <div class="listing-meta">
                            <span>⭐ 4.8 (56 reviews)</span>
                            <span>150+ sales</span>
                        </div>
                    </div>
                </div>
                <div class="listing-card">
                    <div class="listing-image">Code Preview</div>
                    <div class="listing-content">
                        <span class="listing-tag">Python</span>
                        <span class="listing-tag">API</span>
                        <h3 class="listing-title">RESTful API Boilerplate</h3>
                        <div class="listing-price">$29.99</div>
                        <div class="listing-meta">
                            <span>⭐ 4.9 (112 reviews)</span>
                            <span>500+ sales</span>
                        </div>
                    </div>
                </div>
                <div class="listing-card">
                    <div class="listing-image">Code Preview</div>
                    <div class="listing-content">
                        <span class="listing-tag">WordPress</span>
                        <span class="listing-tag">Plugin</span>
                        <h3 class="listing-title">Advanced Contact Form Plugin</h3>
                        <div class="listing-price">$19.99</div>
                        <div class="listing-meta">
                            <span>⭐ 4.7 (89 reviews)</span>
                            <span>320+ sales</span>
                        </div>
                    </div>
                </div>
                <div class="listing-card">
                    <div class="listing-image">Code Preview</div>
                    <div class="listing-content">
                        <span class="listing-tag">JavaScript</span>
                        <span class="listing-tag">Animation</span>
                        <h3 class="listing-title">Interactive Canvas Animations</h3>
                        <div class="listing-price">$34.99</div>
                        <div class="listing-meta">
                            <span>⭐ 4.6 (42 reviews)</span>
                            <span>210+ sales</span>
                        </div>
                    </div>
                </div>
                <div class="listing-card">
                    <div class="listing-image">Code Preview</div>
                    <div class="listing-content">
                        <span class="listing-tag">Flutter</span>
                        <span class="listing-tag">Mobile</span>
                        <h3 class="listing-title">UI Component Library for Flutter</h3>
                        <div class="listing-price">$59.99</div>
                        <div class="listing-meta">
                            <span>⭐ 4.9 (76 reviews)</span>
                            <span>180+ sales</span>
                        </div>
                    </div>
                </div>
                <div class="listing-card">
                    <div class="listing-image">Code Preview</div>
                    <div class="listing-content">
                        <span class="listing-tag">PHP</span>
                        <span class="listing-tag">Backend</span>
                        <h3 class="listing-title">E-commerce Payment Gateway</h3>
                        <div class="listing-price">$79.99</div>
                        <div class="listing-meta">
                            <span>⭐ 4.8 (63 reviews)</span>
                            <span>95+ sales</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="how-it-works" id="how-it-works">
        <div class="container">
            <div class="section-header">
                <h2>How It Works</h2>
                <p>Getting started with CodeMarket is easy and straightforward</p>
            </div>
            <div class="steps">
                <div class="step">
                    <div class="step-number">1</div>
                    <h3>Create an Account</h3>
                    <p>Sign up for free and complete your developer profile to establish trust with buyers.</p>
                </div>
                <div class="step">
                    <div class="step-number">2</div>
                    <h3>List Your Code</h3>
                    <p>Upload your code with detailed descriptions, screenshots, and set your price.</p>
                </div>
                <div class="step">
                    <div class="step-number">3</div>
                    <h3>Secure Sale</h3>
                    <p>When a buyer purchases your code, payment is held in escrow until delivery is confirmed.</p>
                </div>
                <div class="step">
                    <div class="step-number">4</div>
                    <h3>Get Paid</h3>
                    <p>Once the buyer confirms satisfaction, funds are released directly to your account.</p>
                </div>
            </div>
        </div>
    </section>

    <section class="testimonials">
        <div class="container">
            <div class="section-header">
                <h2>What Our Users Say</h2>
                <p>Join thousands of satisfied developers buying and selling on CodeMarket</p>
            </div>
            <div class="testimonial-cards">
                <div class="testimonial-card">
                    <div class="testimonial-content">
                        "CodeMarket saved me weeks of development time. I found exactly the solution I needed and was able to implement it within hours."
                    </div>
                    <div class="testimonial-author">
                        <div class="author-avatar"></div>
                        <div class="author-info">
                            <h4>Alex Johnson</h4>
                            <p>Frontend Developer</p>
                        </div>
                    </div>
                </div>
                <div class="testimonial-card">
                    <div class="testimonial-content">
                        "I've been able to monetize my side projects and code snippets, creating a nice additional income stream. The platform is incredibly easy to use."
                    </div>
                    <div class="testimonial-author">
                        <div class="author-avatar"></div>
                        <div class="author-info">
                            <h4>Sophia Chen</h4>
                            <p>Full Stack Developer</p>
                        </div>
                    </div>
                </div>
                <div class="testimonial-card">
                    <div class="testimonial-content">
                        "The secure payment system gives me peace of mind. I know my intellectual property is protected and I'll get paid for my work."
                    </div>
                    <div class="testimonial-author">
                        <div class="author-avatar"></div>
                        <div class="author-info">
                            <h4>Marcus Williams</h4>
                            <p>Mobile App Developer</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="cta">
        <div class="container">
            <h2>Ready to Start Buying and Selling Code?</h2>
            <p>Join our community of developers and start saving time and earning money today.</p>
            <a href="#" id="cta-signup-btn" class="btn">Create Account</a>
        </div>
    </section>

    <footer>
        <div class="container">
            <div class="footer-grid">
                <div class="footer-column">
                    <h3>CodeMarket</h3>
                    <ul class="footer-links">
                        <li><a href="#marketplace">Browse</a></li>
                        <li><a href="#how-it-works">How It Works</a></li>
                        <li><a href="#">Pricing</a></li>
                        <li><a href="#">Blog</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>For Sellers</h3>
                    <ul class="footer-links">
                        <li><a href="#">Seller Guidelines</a></li>
                        <li><a href="#">Fees & Charges</a></li>
                        <li><a href="#">Copyright Protection</a></li>
                        <li><a href="#">Seller FAQ</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>For Buyers</h3>
                    <ul class="footer-links">
                        <li><a href="#">Buyer Protection</a></li>
                        <li><a href="#">Refund Policy</a></li>
                        <li><a href="#">License Types</a></li>
                        <li><a href="#">Buyer FAQ</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Company</h3>
                    <ul class="footer-links">
                        <li><a href="#">About Us</a></li>
                        <li><a href="#">Contact</a></li>
                        <li><a href="#">Careers</a></li>
                        <li><a href="#">Legal & Terms</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 CodeMarket. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Login Modal -->
    <div class="modal" id="login-modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Login to Your Account</h2>
            <form id="login-form">
                <div class="form-group">
                    <label for="login-email">Email</label>
                    <input type="email" id="login-email" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="login-password">Password</label>
                    <input type="password" id="login-password" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Login</button>
            </form>
            <p style="text-align: center; margin-top: 1rem;">
                Don't have an account? <a href="#" id="switch-to-signup">Sign up</a>
            </p>
        </div>
    </div>

    <!-- Sign Up Modal -->
    <div class="modal" id="signup-modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Create Your Account</h2>
            <form id="signup-form">
                <div class="form-group">
                    <label for="signup-name">Full Name</label>
                    <input type="text" id="signup-name" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="signup-email">Email</label>
                    <input type="email" id="signup-email" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="signup-password">Password</label>
                    <input type="password" id="signup-password" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="signup-confirm">Confirm Password</label>
                    <input type="password" id="signup-confirm" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Create Account</button>
            </form>
            <p style="text-align: center; margin-top: 1rem;">
                Already have an account? <a href="#" id="switch-to-login">Login</a>
            </p>
        </div>
    </div>

    <!-- Sell Code Modal -->
    <div class="modal" id="sell-modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>List Your Code for Sale</h2>
            <form id="sell-form">
                <div class="form-group">
                    <label for="listing-title">Title</label>
                    <input type="text" id="listing-title" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="listing-category">Category</label>
                    <select id="listing-category" class="form-control" required>
                        <option value="">Select Category</option>
                        <option value="web">Web Development</option>
                        <option value="mobile">Mobile Apps</option>
                        <option value="plugins">Plugins & Extensions</option>
                        <option value="games">Game Development</option>
                        <option value="ai">AI & Machine Learning</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="listing-description">Description</label>
                    <textarea id="listing-description" class="form-control" rows="4" required></textarea>
                </div>
                <div class="form-group">
                    <label for="listing-price">Price ($)</label>
                    <input type="number" id="listing-price" class="form-control" min="1" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="listing-file">Upload Code File (ZIP)</label>
                    <input type="file" id="listing-file" class="form-control" accept=".zip" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">List for Sale</button>
            </form>
        </div>
    </div>

    <!-- Payment Modal -->
    <div class="modal" id="payment-modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Complete Your Purchase</h2>
            <div id="payment-details">
                <h3 id="purchase-title">Item Title</h3>
                <p id="purchase-price">$0.00</p>
            </div>
            <form id="payment-form">
                <div class="form-group">
                    <label for="card-element">Credit or Debit Card</label>
                    <div id="card-element" class="form-control"></div>
                    <div id="card-errors" role="alert" style="color: var(--danger); margin-top: 0.5rem;"></div>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Pay Now</button>
            </form>
        </div>
    </div>

    <!-- Success/Error Notification -->
    <div id="notification" style="display: none; position: fixed; bottom: 20px; right: 20px; padding: 15px 25px; border-radius: 4px; color: white; z-index: 1000;"></div>

    <!-- Add Stripe.js for payment processing -->
    <script src="https://js.stripe.com/v3/"></script>
    
    <!-- Add Razorpay.js for Razorpay payment processing -->
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    
    <!-- Main JavaScript -->
    <script>
        // API Configuration
        const API_URL = 'https://api.codemarket.example.com'; // Replace with your actual API URL
        let authToken = localStorage.getItem('authToken');
        let currentUser = null;
        let purchaseItem = null;
        let razorpayInstance = null;
        
        // DOM Elements
        const loginModal = document.getElementById('login-modal');
        const signupModal = document.getElementById('signup-modal');
        const sellModal = document.getElementById('sell-modal');
        const paymentModal = document.getElementById('payment-modal');
        const notification = document.getElementById('notification');
        
        // Modal Controls
        document.getElementById('login-btn').addEventListener('click', () => openModal(loginModal));
        document.getElementById('signup-btn').addEventListener('click', () => openModal(signupModal));
        document.getElementById('sell-code-btn').addEventListener('click', () => {
            if (!authToken) {
                showNotification('Please login first to sell code', 'error');
                openModal(loginModal);
            } else {
                openModal(sellModal);
            }
        });
        document.getElementById('hero-sell-btn').addEventListener('click', () => {
            if (!authToken) {
                showNotification('Please login first to sell code', 'error');
                openModal(loginModal);
            } else {
                openModal(sellModal);
            }
        });
        document.getElementById('cta-signup-btn').addEventListener('click', () => openModal(signupModal));
        
        document.getElementById('switch-to-signup').addEventListener('click', (e) => {
            e.preventDefault();
            closeModal(loginModal);
            openModal(signupModal);
        });
        
        document.getElementById('switch-to-login').addEventListener('click', (e) => {
            e.preventDefault();
            closeModal(signupModal);
            openModal(loginModal);
        });
        
        // Close modals when clicking the X or outside the modal
        document.querySelectorAll('.close-modal').forEach(btn => {
            btn.addEventListener('click', () => {
                closeAllModals();
            });
        });
        
        window.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                closeAllModals();
            }
        });
        
        // Form Submissions
        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            try {
                const response = await fetch(`${API_URL}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, password })
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.message || 'Login failed');
                }
                
                // Store JWT token
                authToken = data.token;
                localStorage.setItem('authToken', authToken);
                currentUser = data.user;
                
                showNotification('Login successful!', 'success');
                closeModal(loginModal);
                updateUIForLoggedInUser();
            } catch (error) {
                showNotification(error.message, 'error');
            }
        });
        
        document.getElementById('signup-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('signup-name').value;
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            const confirmPassword = document.getElementById('signup-confirm').value;
            
            if (password !== confirmPassword) {
                showNotification('Passwords do not match', 'error');
                return;
            }
            
            try {
                const response = await fetch(`${API_URL}/auth/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ name, email, password })
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.message || 'Registration failed');
                }
                
                showNotification('Account created successfully! Please log in.', 'success');
                closeModal(signupModal);
                openModal(loginModal);
            } catch (error) {
                showNotification(error.message, 'error');
            }
        });
        
        document.getElementById('sell-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!authToken) {
                showNotification('Please login first', 'error');
                closeModal(sellModal);
                openModal(loginModal);
                return;
            }
            
            const title = document.getElementById('listing-title').value;
            const category = document.getElementById('listing-category').value;
            const description = document.getElementById('listing-description').value;
            const price = document.getElementById('listing-price').value;
            const file = document.getElementById('listing-file').files[0];
            
            if (!file) {
                showNotification('Please upload a file', 'error');
                return;
            }
            
            const formData = new FormData();
            formData.append('title', title);
            formData.append('category', category);
            formData.append('description', description);
            formData.append('price', price);
            formData.append('file', file);
            
            try {
                const response = await fetch(`${API_URL}/listings`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: formData
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.message || 'Failed to create listing');
                }
                
                showNotification('Your code has been listed successfully!', 'success');
                closeModal(sellModal);
                // Optionally refresh the listings
                fetchListings();
            } catch (error) {
                showNotification(error.message, 'error');
            }
        });
        
        // Stripe Payment Integration
        let stripe;
        let elements;
        let card;
        
        function initializeStripe() {
            stripe = Stripe('pk_test_your_publishable_key'); // Replace with your Stripe publishable key
            elements = stripe.elements();
            
            // Create card element
            card = elements.create('card', {
                style: {
                    base: {
                        fontSize: '16px',
                        color: '#32325d',
                    }
                }
            });
        }
        
        function mountCardElement() {
            card.mount('#card-element');
            
            // Handle validation errors
            card.addEventListener('change', function(event) {
                const displayError = document.getElementById('card-errors');
                if (event.error) {
                    displayError.textContent = event.error.message;
                } else {
                    displayError.textContent = '';
                }
            });
        }
        
        document.getElementById('payment-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!authToken) {
                showNotification('Please login first', 'error');
                closeModal(paymentModal);
                openModal(loginModal);
                return;
            }
            
            try {
                // Create payment intent on the server
                const response = await fetch(`${API_URL}/payments/create-intent`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        listingId: purchaseItem.id,
                        amount: purchaseItem.price * 100 // Stripe uses cents
                    })
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.message || 'Payment initialization failed');
                }
                
                // Confirm the payment with Stripe
                const result = await stripe.confirmCardPayment(data.clientSecret, {
                    payment_method: {
                        card: card,
                        billing_details: {
                            name: currentUser.name,
                            email: currentUser.email
                        }
                    }
                });
                
                if (result.error) {
                    throw new Error(result.error.message);
                } else if (result.paymentIntent.status === 'succeeded') {
                    // Payment successful, complete the purchase on the server
                    const purchaseResponse = await fetch(`${API_URL}/purchases`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${authToken}`
                        },
                        body: JSON.stringify({
                            listingId: purchaseItem.id,
                            paymentIntentId: result.paymentIntent.id
                        })
                    });
                    
                    const purchaseData = await purchaseResponse.json();
                    
                    if (!purchaseResponse.ok) {
                        throw new Error(purchaseData.message || 'Purchase completion failed');
                    }
                    
                    showNotification('Payment successful! You can now download the code.', 'success');
                    closeModal(paymentModal);
                    
                    // Redirect to download page or show download button
                    window.location.href = `/download/${purchaseData.purchaseId}`;
                }
            } catch (error) {
                showNotification(error.message, 'error');
            }
        });
        
        // Initialize Razorpay
        function initializeRazorpay() {
            if (window.Razorpay) {
                razorpayInstance = new window.Razorpay({
                    key: '', // Will be set when creating order
                    image: 'https://i.imgur.com/n5tjHFD.png', // Your logo URL
                    theme: {
                        color: '#3498db'
                    }
                });
            } else {
                console.error('Razorpay SDK failed to load');
            }
        }
        
        // Handle payment for a listing
        async function handlePayment(listingId, title, price) {
            if (!authToken) {
                showNotification('Please login to make a purchase', 'error');
                openModal(loginModal);
                return;
            }
            
            purchaseItem = {
                id: listingId,
                title: title,
                price: price
            };
            
            try {
                // Create Razorpay order
                const response = await fetch(`${API_URL}/payments/create-order`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        listingId: purchaseItem.id
                    })
                });
                
                const orderData = await response.json();
                
                if (!response.ok) {
                    throw new Error(orderData.message || 'Failed to create order');
                }
                
                // Initialize Razorpay if not already done
                if (!razorpayInstance) {
                    initializeRazorpay();
                }
                
                // Configure Razorpay options
                const options = {
                    key: orderData.keyId,
                    amount: orderData.amount,
                    currency: orderData.currency,
                    name: 'CodeMarket',
                    description: `Purchase: ${purchaseItem.title}`,
                    order_id: orderData.orderId,
                    handler: async function(response) {
                        try {
                            // Verify payment
                            const verifyResponse = await fetch(`${API_URL}/payments/verify`, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'Authorization': `Bearer ${authToken}`
                                },
                                body: JSON.stringify({
                                    razorpay_payment_id: response.razorpay_payment_id,
                                    razorpay_order_id: response.razorpay_order_id,
                                    razorpay_signature: response.razorpay_signature,
                                    listingId: purchaseItem.id
                                })
                            });
                            
                            const purchaseData = await verifyResponse.json();
                            
                            if (!verifyResponse.ok) {
                                throw new Error(purchaseData.message || 'Payment verification failed');
                            }
                            
                            showNotification('Payment successful! Your code is ready to download.', 'success');
                            
                            // Redirect to download page or show download button
                            window.location.href = `/download?url=${encodeURIComponent(purchaseData.downloadUrl)}`;
                        } catch (error) {
                            showNotification(error.message, 'error');
                        }
                    },
                    prefill: {
                        name: currentUser?.name || '',
                        email: currentUser?.email || ''
                    },
                    theme: {
                        color: '#3498db'
                    }
                };
                
                // Open Razorpay payment form
                razorpayInstance.open(options);
            } catch (error) {
                showNotification(error.message, 'error');
            }
        }
        
        // Add click event listeners to buy buttons
        function addBuyButtonListeners() {
            document.querySelectorAll('.buy-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    e.preventDefault();
                    const listingId = button.getAttribute('data-id');
                    const title = button.getAttribute('data-title');
                    const price = parseFloat(button.getAttribute('data-price'));
                    handlePayment(listingId, title, price);
                });
            });
        }
        
        // Fetch listings from API
        async function fetchListings() {
            try {
                const response = await fetch(`${API_URL}/listings`);
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.message || 'Failed to fetch listings');
                }
                
                // Update the UI with the fetched listings
                updateListingsUI(data.listings);
                
                // Add event listeners to buy buttons
                addBuyButtonListeners();
            } catch (error) {
                console.error('Error fetching listings:', error);
                showNotification(error.message, 'error');
            }
        }
        
        // Update listings UI
        function updateListingsUI(listings) {
            const listingsGrid = document.querySelector('.listings-grid');
            
            if (!listingsGrid) {
                console.error('Listings grid element not found');
                return;
            }
            
            // Clear existing listings
            listingsGrid.innerHTML = '';
            
            if (listings.length === 0) {
                listingsGrid.innerHTML = '<p class="no-listings">No listings found</p>';
                return;
            }
            
            // Add each listing to the grid
            listings.forEach(listing => {
                const listingCard = document.createElement('div');
                listingCard.className = 'listing-card';
                
                listingCard.innerHTML = `
                    <div class="listing-image">Code Preview</div>
                    <div class="listing-content">
                        ${listing.tags.map(tag => `<span class="listing-tag">${tag}</span>`).join('')}
                        <h3 class="listing-title">${listing.title}</h3>
                        <div class="listing-price">$${listing.price.toFixed(2)}</div>
                        <div class="listing-meta">
                            <span>⭐ ${listing.rating.toFixed(1)} (${listing.reviewCount} reviews)</span>
                            <span>${listing.sales}+ sales</span>
                        </div>
                        <button class="btn btn-primary buy-btn" 
                            data-id="${listing._id}" 
                            data-title="${listing.title}" 
                            data-price="${listing.price}">
                            Buy Now
                        </button>
                    </div>
                `;
                
                listingsGrid.appendChild(listingCard);
            });
            
            // Add event listeners to buy buttons
            addBuyButtonListeners();
        }
        
        // Check if user is already logged in
        async function checkAuthStatus() {
            if (authToken) {
                try {
                    const response = await fetch(`${API_URL}/auth/me`, {
                        headers: {
                            'Authorization': `Bearer ${authToken}`
                        }
                    });
                    
                    const data = await response.json();
                    
                    if (!response.ok) {
                        throw new Error(data.message || 'Authentication failed');
                    }
                    
                    currentUser = data.user;
                    updateUIForLoggedInUser();
                } catch (error) {
                    console.error('Auth check failed:', error);
                    // Clear invalid token
                    authToken = null;
                    localStorage.removeItem('authToken');
                }
            }
        }
        
        // Update UI for logged in user
        function updateUIForLoggedInUser() {
            const loginBtn = document.getElementById('login-btn');
            const signupBtn = document.getElementById('signup-btn');
            
            if (loginBtn && signupBtn) {
                loginBtn.textContent = 'My Account';
                loginBtn.href = '/account';
                signupBtn.textContent = 'Logout';
                signupBtn.classList.remove('btn-primary');
                signupBtn.classList.add('btn-outline');
                
                // Change signup button to logout functionality
                signupBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    logout();
                });
            }
        }
        
        function logout() {
            authToken = null;
            currentUser = null;
            localStorage.removeItem('authToken');
            showNotification('You have been logged out', 'success');
            
            // Reset UI
            const loginBtn = document.getElementById('login-btn');
            const signupBtn = document.getElementById('signup-btn');
            
            if (loginBtn && signupBtn) {
                loginBtn.textContent = 'Login';
                loginBtn.href = '#';
                signupBtn.textContent = 'Sign Up';
                signupBtn.classList.remove('btn-outline');
                signupBtn.classList.add('btn-primary');
                
                // Restore original signup functionality
                signupBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    openModal(signupModal);
                });
            }
            
            // Redirect to home if on a protected page
            if (window.location.pathname.startsWith('/account') || 
                window.location.pathname.startsWith('/download')) {
                window.location.href = '/';
            }
        }
        
        // Utility functions
        function openModal(modal) {
            closeAllModals();
            modal.style.display = 'flex';
        }
        
        function closeModal(modal) {
            modal.style.display = 'none';
        }
        
        function closeAllModals() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.style.display = 'none';
            });
        }
        
        function showNotification(message, type) {
            notification.textContent = message;
            notification.style.display = 'block';
            
            if (type === 'success') {
                notification.style.backgroundColor = 'var(--secondary)';
            } else if (type === 'error') {
                notification.style.backgroundColor = 'var(--danger)';
            } else {
                notification.style.backgroundColor = 'var(--primary)';
            }
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 5000);
        }
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            checkAuthStatus();
            fetchListings();
            
            // Initialize Razorpay
            if (window.Razorpay) {
                initializeRazorpay();
            }
        });
    </script>
</body>
</html>